tosca_definitions_version: cloudify_dsl_1_3

imports:
  - https://cloudify.co/spec/cloudify/6.2.0/types.yaml
  - plugin:cloudify-utilities-plugin?version= >=1.25.3
  - includes/sites.yaml

inputs:

  dci_name_suffix:
    type: string
    description: Name of DCI Resource.

  east_site_subnet_cidr:
    description: >
      Subnet CIDR of west site.
    type: string

  west_site_subnet_cidr:
    description: >
      Subnet CIDR of west site.
    type: string

node_templates:

  l3evpn_dci:
    type: cloudify.rest.Requests
    properties:
      host: { get_input: host }
      port: { get_input: port }
      ssl: false
      verify: false
    interfaces:
      cloudify.interfaces.lifecycle:
        start:
          inputs:
            template_file: templates/l3evpn_dci_create.yaml
            prerender: true
            params:
              NAME: { concat: [ cloudify-, { get_input: dci_name_suffix } ] }
              EAST_SITE_UUID: { get_input: east_site_uuid }
              EAST_SITE_SUBNET_CIDR: { get_input: east_site_subnet_cidr }
              WEST_SITE_UUID: { get_input: west_site_uuid }
              WEST_SITE_SUBNET_CIDR: { get_input: west_site_subnet_cidr }
        stop:
          inputs:
            template_file: templates/l3evpn_dci_delete.yaml
            prerender: true
            params:
              L3EVPN_DCI_UUID: { get_attribute: [SELF, result_properties, L3EVPN_DCI_UUID] }
    relationships:
      - type: cloudify.relationships.depends_on
        target: east_site
      - type: cloudify.relationships.depends_on
        target: west_site
